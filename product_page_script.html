<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    $(document).ready(function() {
        let preview_pic = $(".product-single__media-group")
        let show_preview = $("#show_preview")
        let data = $("#custom_options_form :input")

        let paper_size = $("#SingleOptionSelector-0")
        let paper_stock = $("#SingleOptionSelector-1")
        let quantity = $("#SingleOptionSelector-2")
    
        show_preview.click(function(e) {
            e.preventDefault()
            let data_content = data.serializeArray()
            
            let data_payload = {
                "font_type": data_content.filter((e) => {return e.name == "fonts"})[0].value,
                "paper_type": convert_paper_size(paper_size.val()),
                "paper_color": convert_paper_stock(paper_stock.val()),
                "alignment": "right_left",
                "text_color": data_content.filter((e) => {return e.name == "text-color"})[0].value,
                "quantity": quantity.val(),
                "lines": {
                    "line1": data_content.filter((e) => {return e.name == "line1"})[0].value,
                    "line2": data_content.filter((e) => {return e.name == "line2"})[0].value,
                    "line3": data_content.filter((e) => {return e.name == "line3"})[0].value,
                    "line4": data_content.filter((e) => {return e.name == "line4"})[0].value
                }
            }

            update_photo(data_payload)
        })

        let update_photo = function(data_payload){
            let element_html = `<div id="FeaturedMedia-pp-preview-pic-wrapper" data-product-single-media-wrapper="" data-media-id="" tabindex="-1" class="product-single__media-wrapper js"> <style>#FeaturedMedia-pp-preview-pic{max-width: 386.0px; max-height: 493px;}#FeaturedMedia-pp-preview-pic-wrapper{max-width: 386.0px;}</style> <img id="FeaturedMedia-pp-preview-pic" class="feature-row__image product-featured-media lazyautosizes ls-is-cached lazyloaded" src=""></div>`
            // Get the photo from server
            $.ajax({
                type:"POST",
                url: "https://pp-custom-stationary-preview.herokuapp.com/generate-image",
                data: data_payload,
                dataType: "json",
                success: function(returned_data){
                    console.log(returned_data)
                    if($("#FeaturedMedia-pp-preview-pic").length){
                        $("#FeaturedMedia-pp-preview-pic").replaceWith(returned_data)
                    } else {
                        preview_pic.append(element_html)
                        $("#FeaturedMedia-pp-preview-pic").replaceWith(returned_data)
                    }
                }
            }).done(function(){
                preview_pic.children().addClass("hide")
                $("#FeaturedMedia-pp-preview-pic-wrapper").removeClass("hide")
            }).fail(function() {
                alert("There was an error generating a preview. Please try again.")
            }).always(function(){
                alert("All done.")
            })
            
            //Check to see if image already exists
                // If yes, just change source attr
                
                // If no, add classes for lightbox
                // Add to preview pic list

            // Add 'hide' class to all other nodes in list
            // Check if photo has hide class, if yes then remove
        }

        let convert_paper_stock = function(paper_color_value){
            switch(paper_color_value){
                case "Oxford Cream": return "oxford_cream"
                case "Oxford White": return "oxford_white"
                case "Rives Sand": return "rives_sand"
                case "Rives Wheat": return "rives_wheat"
                case "Rives White": return "rives_white"
                case "Speckletone": return "speckletone"
                case "Superfine White": return "superfine_white"
            }
        }

        let convert_paper_size = function(paper_size_value){
            switch(paper_size_value){
                case "A5": return "a5_paper"
                case "A6": return "a6_paper"
            }
        }
    })
</script>

<div id="custom_options_form">
    <label> Enter your custom text: </label>
    <input name="line1" type="text" placeholder="Line 1"> </input>
    <input name="line2" type="text" placeholder="Line 2"> </input>
    <input name="line3" type="text" placeholder="Line 3"> </input>
    <input name="line4" type="text" placeholder="Line 4"> </input>
    <br>
    <label for="text-color">Choose a font color:</label>
    <select id="text-color" name="text-color">
      <option value="navy">Navy</option>
      <option value="brown">Brown</option>
      <option value="black">Black</option>
    </select> 
    <br>
    <label for="fonts">Choose a font:</label>
    <select id="fonts" name="fonts">
      <option value="bernhard">Bernhard</option>
      <option value="gabriola">Gabriola</option>
      <option value="garamond">Garmond</option>
      <option value="shelley_allegro">Shelly Allegro</option>
    </select>
    <br>
    <br>
    <button id="show_preview"> Show Preview </button>
</div>